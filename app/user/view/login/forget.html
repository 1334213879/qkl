<!DOCTYPE html>
<html style="width:100%;height:100%;">
<head>
    <meta charset="utf-8">
    <title>{$title}</title>
	<script src="__HOME__/js/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<script src="__HOME__/js/jquery.min.js"></script>
	<script src="__STATIC__/user/layui/layui.js"></script>
	<link rel="stylesheet" href="__STATIC__/user/layui/css/layui.css">
    <link rel="stylesheet" href="__STATIC__/xmt/css/pages/loginpage.css">
</head>    
<body class="login_bg">
<div class="smz_x" onclick="location.href ='{:url('user/login/index')}';">
	<img style="width:25px;height:25px;" src="__HOME__/btb/fh.png"/>
</div>
	<div class="register">
		<h2>{:lang('找回密码')}</h2>
		<div>
			<div class="notice_info">
			<i><img src="__STATIC__/xmt/images/mobile.png" alt=""></i><span>{:lang('手机号码')}</span>
			</div>
			<span>
				<input id="mobile" name="mobile" type="text" placeholder="{:lang('请输入手机号码')}" maxlength='11'/>
			</span>
		</div>
		<div>
			<div class="notice_info">
			<i><img src="__STATIC__/xmt/images/checkcode.png" alt=""></i><span>{:lang('短信验证码')}</span>
			</div>
			<span><input id="sms" type="text" placeholder="{:lang('短信验证码')}" maxlength='6'/></span>
			<div class='send_phone' onclick='send_phone()'>
			<span id='zphone'>{:lang('获取验证码')}</span>
			</div>			
		</div>
		<div>
			<div class="notice_info">
			<i><img src="__STATIC__/xmt/images/checkcode.png" alt=""></i><span>{:lang('重置密码')}</span>
			</div>
			<span>
			<input id="mm" type="password" placeholder="{:lang('请输入6到12个字符的密码')}" maxlength='12'/>
			</span>			
		</div>
		<div>
			<div class="notice_info">
			<i><img src="__STATIC__/xmt/images/checkcode.png" alt=""></i><span>{:lang('确认密码')}</span>
			</div>
			<span><input id="mm1" type="password" placeholder="{:lang('请再次输入密码')}" maxlength='12'/></span>
		</div>
		<div class="sub" onclick="kq($('#yzm').text())">
			{:lang('提交')}
		</div>
	</div>

<script type="text/javascript"> 
var countdown=60; 
function settime(val) { 
if (countdown == 0) { 
val.removeAttribute("disabled"); 
val.value="{:lang('获取验证码')}";
countdown = 60; 
} else { 
val.setAttribute("disabled", true); 
val.value="{:lang('重新发送')}(" + countdown + ")";
countdown--; 
setTimeout(function() { 
settime(val) 
},1000) 
} 
} 
</script>
<script type="text/javascript">  
function kq(yzm){
	if($("#mobile").val()=="" || !/^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/i.test($("#mobile").val())){
		layer.msg('{:lang(\'请填写注册手机号码\')}');$('#mobile').val('');return false;
	}
	if($("#sms").val()==""){
		layer.msg('{:lang(\'请填写验证码\')}');return false;
	}
	if($("#mm").val()==""|| $("#mm").val().length<6){
		layer.msg('{:lang(\'密码至少为6位\')}');return false;
	}
	if($("#mm").val()!=$("#mm1").val()){
		layer.msg('{:lang(\'密码不一致\')}');return false;
	}
	else if($("#mm").val()==$("#mm1").val()){
			$.post("{:url('forget')}",
			{password:$("#mm").val(),mobile:$("#mobile").val(),code:$("#sms").val()},function(res){
				if(res.code > 0){
					layer.msg(res.msg,{time:1800},function(){
                    location.href = "{:url('index')}";
                    });
					}else{
					layer.msg(res.msg,{time:1800});
				}
			});
	}else{
		layer.msg('{:lang(\'验证码错误\')}');return false;
	}
}
function send_phone(){
    var obj = $("#zphone");
	var mobile=$("#mobile").val();
	if($("#mobile").val()=="" || !/^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/i.test($("#mobile").val())){
		layer.msg('{:lang(\'请填写注册手机号码\')}');
		$('#mobile').val('');
		return false;
	}
        var email = $('#mobile').val();
        $.post("{:url('sendEmail')}",{email:email},function(res){
            if(res.code > 0){
                layer.msg(res.msg,{time:1800});
				//$('.send_phone').remove();
				//$('.reg_yzm').append("<div class='send_phone'>&nbsp&nbsp <span id='zphone' style='color:#50b936;text-align:right;'>输入验证码</span></div>");
            }else{
                layer.msg(res.msg,{time:1800});
            }
        });
}
</script> 
<!-- 倒计时 -->
<script>
    layui.use(['form', 'layer'], function () {
        var form = layui.form(),layer = layui.layer;
        // 登录提交监听
        form.on('submit(sub)', function (data) {
            // 提交到方法 默认为本身
            $.post("{:url('reg')}",data.field,function(res){
                if(res.code > 0){
                    layer.msg(res.msg,{time:1800},function(){
                       location.href = "{:url('../home/index/sy')}";
                    });
                }else{
                    layer.msg(res.msg,{time:1800});
                }
            });
        })
    })
</script>
</body>
</html>